# 进程/线程/协程

### 1. 进程

进程是**资源分配的基本单位**。

进程控制块 (Process Control Block, PCB) 描述进程的基本信息和运行状态，所谓的创建进程和撤销进程，都是指对 PCB 的操作。

下图显示了 4 个程序创建了 4 个进程，这 4 个进程可以并发地执行。

[![img](https://github.com/CyC2018/CS-Notes/raw/master/pics/a6ac2b08-3861-4e85-baa8-382287bfee9f.png)](https://github.com/CyC2018/CS-Notes/blob/master/pics/a6ac2b08-3861-4e85-baa8-382287bfee9f.png)



> 进程间通信的几种方式



### 2. 线程

线程是**独立调度的基本单位**。

一个进程中可以有多个线程，它们共享进程资源。

QQ 和浏览器是两个进程，浏览器进程里面有很多线程，例如 HTTP 请求线程、事件响应线程、渲染线程等等，线程的并发执行使得在浏览器中点击一个新链接从而发起 HTTP 请求时，浏览器还可以响应用户的其它事件。

[![img](https://github.com/CyC2018/CS-Notes/raw/master/pics/3cd630ea-017c-488d-ad1d-732b4efeddf5.png)](https://github.com/CyC2018/CS-Notes/blob/master/pics/3cd630ea-017c-488d-ad1d-732b4efeddf5.png)



**进程和线程的主要差别在于它们是不同的操作系统资源管理方式。进程有独立的地址空间，一个进程崩溃后，在保护模式下不会对其它进程产生影响，而线程只是一个进程中的不同执行路径。线程有自己的堆栈和局部变量，但线程之间没有单独的地址空间，一个线程死掉就等于整个进程死掉，所以多进程的程序要比多线程的程序健壮，但在进程切换时，耗费资源较大，效率要差一些。但对于一些要求同时进行并且又要共享某些变量的并发操作，只能用线程，不能用进程。**

### 3. 区别

Ⅰ **拥有资源**

进程有独立的**地址空间**。一个进程崩溃保护模式下不对其他进程有影响。

线程有自己的**堆栈**和**局部变量**，但线程之间没有单独的地址空间，一个线程死掉则整个进程死掉。

进程是资源分配的基本单位,但是线程不拥有资源，线程可以访问隶属进程的资源。

Ⅱ **调度**

线程是独立调度的基本单位，在同一进程中，线程的切换不会引起进程切换，从一个进程中的线程切换到另一个进程中的线程时，会引起进程切换。

Ⅲ **系统开销**

由于创建或撤销进程时，系统都要为之分配或回收资源，如内存空间、I/O 设备等，所付出的开销远大于创建或撤销线程时的开销。类似地，在进行进程切换时，涉及当前执行进程 CPU 环境的保存及新调度进程 CPU 环境的设置，而线程切换时只需保存和设置少量寄存器内容，开销很小。

Ⅳ **通信方面**

线程间可以通过直接读写同一进程中的数据进行通信，但是进程通信需要借助 IPC。

